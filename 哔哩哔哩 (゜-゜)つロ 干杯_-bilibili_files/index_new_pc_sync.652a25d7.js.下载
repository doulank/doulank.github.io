/*
BUILT_AT: 2019年12月2日 11:20
*/
!function(e){function t(t){for(var i,r,s=t[0],u=t[1],f=t[2],c=0,p=[];c<s.length;c++)r=s[c],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,f||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(i=!1)}i&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},o={2:0},a=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="//s2.hdslb.com/bfs/static/blive/blfe-message-navbar/";var s=("undefined"!=typeof self?self:this).webpackJsonp=("undefined"!=typeof self?self:this).webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var f=0;f<s.length;f++)t(s[f]);var l=u;a.push([183,1,0]),n()}({182:function(e,t,n){},183:function(e,t,n){"use strict";n.r(t);var i=n(30),o=n.n(i),a=(n(182),n(31),n(26),n(91),n(13),n(66),n(27),n(69),n(16),n(94),n(22),n(73),n(99),n(75),n(6)),r=n.n(a),s=(n(76),n(14)),u={get:function(e){var t=""+document.cookie,n=t.indexOf(e+"=");if(-1==n||""==e)return"";var i=t.indexOf(";",n);return-1==i&&(i=t.length),unescape(t.substring(n+e.length+1,i))},set:function(e,t,n){n=void 0!==n?n:365;var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()+"; path=/; domain=.bilibili.com"},delete:function(e){this.set(e,"",-1)}},f={"zh-CN":{replyMe:"回复我的",atMe:"@我的",praiseMe:"收到的赞",system:"系统通知",whisper:"我的消息"},"zh-TW":{replyMe:"回复我的",atMe:"@我的",praiseMe:"收到的讚",system:"系統通知",whisper:"我的消息"}};function l(e){return(t=u.get("LNG")||"zh-CN",f[t]||{})[e]||e;var t}function c(e,t,n,i,o,a,r){try{var s=e[a](r),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,o)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var a=e.apply(t,n);function r(e){c(a,i,o,r,s,"next",e)}function s(e){c(a,i,o,r,s,"throw",e)}r(void 0)})}}var d,m,y={data:function(){return{uid:"",notifyCounts:{at_me:0,reply_me:0,praise_me:0,notify_me:0,message:0},notifyType:0,availableNotifyType:[0,1,2],showUnfollowedMsg:1,im_list:[{name:"reply_me",text:l("replyMe"),href:"//message.bilibili.com/#/reply"},{name:"at_me",text:l("atMe"),href:"//message.bilibili.com/#/at"},{name:"praise_me",text:l("praiseMe"),href:"//message.bilibili.com/#/love"},{name:"notify_me",text:l("system"),href:"//message.bilibili.com/#/system"},{name:"message",text:l("whisper"),href:"//message.bilibili.com/#/whisper"}]}},watch:{notifyCounts:{handler:function(){this.postMessage()},deep:!0},notifyType:function(){this.postMessage()}},mounted:(m=p(r.a.mark(function e(){var t=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.getUid(),this.getNotifyType(),this.getnotifyCounts()]);case 2:return e.next=4,this.getUnreadMessageCount(!0);case 4:setInterval(function(){t.getUnreadMessageCount()},6e4),window.addEventListener("storage",function(e){e.key==="imNotifyCounts".concat(t.uid)?t.notifyCounts=JSON.parse(e.newValue):e.key==="im_notify_type_".concat(t.uid)&&(t.notifyType=parseInt(e.newValue))});case 6:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)}),methods:{getUid:function(){var e=this;return Object(s.a)({addPlatInfo:!0,url:"//api.bilibili.com/x/web-interface/nav",method:"get"}).then(function(t){e.uid=t.data.mid})},getUnreadMessageCount:(d=p(r.a.mark(function e(){var t,n,i,o=this,a=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]&&a[0],n=function(){var e=p(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.a)({addPlatInfo:!0,url:"//api.vc.bilibili.com/session_svr/v1/session_svr/single_unread",method:"get",data:{unread_type:0}}).then(function(e){return o.unfollowFold?e.data.follow_unread:e.data.follow_unread+e.data.unfollow_unread});case 2:o.notifyCounts.message=e.sent,localStorage.setItem("imNotifyCounts".concat(o.uid),JSON.stringify(o.notifyCounts)),localStorage.setItem("unreadApiRequestedBy".concat(o.uid,"At"),Date.now());case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),t?n():parseInt(localStorage.getItem("unreadApiRequestedBy".concat(this.uid,"At")))+6e4>Date.now()?(i=JSON.parse(localStorage.getItem("imNotifyCounts".concat(this.uid)))||{},this.notifyCounts.message=parseInt(i.message)||0):n();case 3:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)}),getnotifyCounts:function(){var e=this;return Object(s.a)({addPlatInfo:!0,url:"//api.bilibili.com/x/msgfeed/unread",method:"get"}).then(function(t){0===t.code&&(e.notifyCounts=Object.assign(e.notifyCounts,{at_me:t.data.at,reply_me:t.data.reply,praise_me:t.data.like,notify_me:t.data.sys_msg}))})},getNotifyType:function(){var e=this;return Object(s.a)({addPlatInfo:!0,url:"//api.vc.bilibili.com/link_setting/v1/link_setting/get",method:"get",data:{msg_notify:1,show_unfollowed_msg:1}}).then(function(t){if(0===t.code){var n=t.data.msg_notify-1;e.availableNotifyType.indexOf(n)>-1&&(e.notifyType=n),e.unfollowFold=1===Number(t.data.show_unfollowed_msg)}})},postMessage:function(){var e=this,t=Object.keys(this.notifyCounts).reduce(function(t,n){return t+e.notifyCounts[n]},0);window.parent.postMessage({type:"nav-im-update",count:t,notifyType:this.notifyType},"*")},displayCount:function(e){return e>99?"99+":e}}},h=n(57),g=Object(h.a)(y,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"im-root"},[n("div",{staticClass:"im-list-box"},e._l(e.im_list,function(t){return n("a",{key:t.name,staticClass:"im-list",attrs:{href:t.href,target:"_blank"}},[e._v("\n      "+e._s(t.text)+"\n      "),0===e.notifyType&&e.notifyCounts[t.name]>0?n("span",{staticClass:"im-notify im-number im-center"},[e._v(e._s(e.displayCount(e.notifyCounts[t.name])))]):e._e(),1===e.notifyType&&e.notifyCounts[t.name]>0?n("span",{staticClass:"im-notify im-dot im-center"}):e._e()])}),0)])},[],!1,null,null,null).exports;o.a.config.productionTip=!1,new o.a({render:function(e){return e(g)}}).$mount("#nav-im-part")}});